<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"eejhongxin.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="见你潜入深海，伴我匿于人间">
<meta property="og:type" content="website">
<meta property="og:title" content="嵌入小屋">
<meta property="og:url" content="https://eejhongxin.github.io/index.html">
<meta property="og:site_name" content="嵌入小屋">
<meta property="og:description" content="见你潜入深海，伴我匿于人间">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="eejhx">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://eejhongxin.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>嵌入小屋</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">嵌入小屋</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="download fa-fw"></i>resources</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://eejhongxin.github.io/2024/12/12/ESP32%E6%9D%BF%E5%AD%90%E9%97%AE%E9%A2%98%E5%B0%8F%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="eejhx">
      <meta itemprop="description" content="见你潜入深海，伴我匿于人间">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="嵌入小屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/12/12/ESP32%E6%9D%BF%E5%AD%90%E9%97%AE%E9%A2%98%E5%B0%8F%E5%BD%95/" class="post-title-link" itemprop="url">ESP32板子设计问题记录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-12-12 23:24:50" itemprop="dateCreated datePublished" datetime="2024-12-12T23:24:50+08:00">2024-12-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2026-01-17 21:26:33" itemprop="dateModified" datetime="2026-01-17T21:26:33+08:00">2026-01-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ESP32/" itemprop="url" rel="index"><span itemprop="name">ESP32</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://eejhongxin.github.io/2024/11/22/ESP32%E4%BD%BF%E7%94%A8I2S%E3%80%81ADC%E9%87%87%E6%A0%B7%E9%BA%A6%E5%85%8B%E9%A3%8E%E8%BF%9B%E8%A1%8C%E9%9F%B3%E9%A2%91%E9%87%87%E9%9B%86%E4%B8%8E%E6%92%AD%E6%94%BE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="eejhx">
      <meta itemprop="description" content="见你潜入深海，伴我匿于人间">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="嵌入小屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/11/22/ESP32%E4%BD%BF%E7%94%A8I2S%E3%80%81ADC%E9%87%87%E6%A0%B7%E9%BA%A6%E5%85%8B%E9%A3%8E%E8%BF%9B%E8%A1%8C%E9%9F%B3%E9%A2%91%E9%87%87%E9%9B%86%E4%B8%8E%E6%92%AD%E6%94%BE/" class="post-title-link" itemprop="url">ESP32使用I2S、ADC采样麦克风进行音频采集与播放</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-11-22 20:33:29" itemprop="dateCreated datePublished" datetime="2024-11-22T20:33:29+08:00">2024-11-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2026-01-17 21:26:33" itemprop="dateModified" datetime="2026-01-17T21:26:33+08:00">2026-01-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ESP32/" itemprop="url" rel="index"><span itemprop="name">ESP32</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->
<ul>
<li><a href="#协议介绍"><strong>协议介绍</strong></a>
<ul>
<li><a href="#i2s总线规范">I2S总线规范</a>
<ul>
<li><a href="#三种信号线">三种信号线</a></li>
<li><a href="#工作模式">工作模式</a></li>
</ul></li>
<li><a href="#adcanalog-to-digital-converter通信协议规范">ADC（Analog-to-Digital
Converter）通信协议规范</a>
<ul>
<li><a href="#常规adc信号采样在音频领域存在的瑕疵">常规ADC信号采样在音频领域存在的瑕疵</a></li>
</ul></li>
<li><a href="#采用i2s传输协议优化adc采样">采用I2S传输协议优化ADC采样</a></li>
</ul></li>
<li><a href="#系统搭建">系统搭建</a>
<ul>
<li><a href="#硬件部分">硬件部分</a></li>
<li><a href="#软件部分">软件部分</a>
<ul>
<li><a href="#i2s协议配置">I2S协议配置</a></li>
<li><a href="#adc模式下的i2s配置">ADC模式下的I2S配置</a></li>
</ul></li>
</ul></li>
</ul>
<!-- tocstop -->
<h1><span id="协议介绍"><strong>协议介绍</strong></span></h1>
<h2><span id="i2s总线规范">I2S总线规范</span></h2>
<h3><span id="三种信号线">三种信号线</span></h3>
<ol type="1">
<li><p>SCK串行时钟：</p>
<p>对应的数字音频的每一位音频数据，SCK都有1个脉冲，SCK的频率=2×采样频率×采样位数。</p></li>
<li><p>WS字段（声道选择）：</p>
<p>用于切换左右声道的数据。WS的频率=采样频率</p>
<p>命令选择线表明了正在被传输的声道。</p>
<p>WS为“1”表示正在传输的是左声道的数据。
WS为“0”表示正在传输的是右声道的数据。
WS可以在串行时钟的上升沿或者下降沿发生改变，并且WS信号不需要一定是对称的。在从属装置端，WS在时钟信号的上升沿发生改变。WS总是在最高位传输前的一个时钟周期发生改变，这样可以使从属装置得到与被传输的串行数据同步的时间，并且使接收端存储当前的命令以及为下次的命令清除空间。</p></li>
<li><p>SD串行数据：</p>
<p>这个其实就是我们常说的数据端口了。</p></li>
</ol>
<h3><span id="工作模式">工作模式</span></h3>
<p>I2S工作模式可以是主模式（Master Mode）或从模式（Slave
Mode）。两者唯一的区别是：提供时钟信号（SCK）和帧同步信号（LRCK）的主题不同。如下图所示，一共存在三种工作模式，分别是：</p>
<p>1.发射器（transmitter）为Master，接收器（receiver）为Slave，此时由发射器提供SCK和LRCK</p>
<p>2.接收器（receiver）为Master，发射器（transmitter）为Slave，此时由接收器提供SCK和LRCK</p>
<p>3.发射器（transmitter）和接收器（receiver）均为Slave，由系统中其他模块提供SCK和LRCK</p>
<figure>
<img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20241126192005435.png" alt="image-20241126192005435">
<figcaption aria-hidden="true">image-20241126192005435</figcaption>
</figure>
<h2><span id="adcanalog-to-digitalconverter通信协议规范">ADC（Analog-to-Digital
Converter）通信协议规范</span></h2>
<p>adc采样大家应该都不陌生，就是模拟信号转换成数字信号的转换器，这个用途在于采集单片机ADC引脚信号，因为本质上我们的音频信号就是由一个个电压信号组成的，如果采集到了相应的ADC引脚信号，那么我们也就可以相应的复现出音频信号。</p>
<h3><span id="常规adc信号采样在音频领域存在的瑕疵">常规ADC信号采样在音频领域存在的瑕疵</span></h3>
<p>但是如果大家尝试直接用analogread（我这里以arduino里面读取电压的方式为例）或者更为底层的去读取引脚的电压值，如果直接使用DAC引脚输出读取到的电压值时会发现声音非常卡完全不像一个音频信号。以我下面这段代码为例。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">void setup() {</span><br><span class="line">  Serial.begin(115200);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// the loop routine runs over and over again forever:</span><br><span class="line">void loop() {</span><br><span class="line">  float startT=micros();</span><br><span class="line">  float sensorValue = analogRead(A0);</span><br><span class="line">  float voltage = sensorValue * (5.0 / 1023.0);</span><br><span class="line">  float endT=micros();</span><br><span class="line">  Serial.printf("voltage:%f,time:%f\n",sensorValue,endT-startT);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>这就是很简单的一段读取引脚电压的程序，最后的输出结果如下，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">voltage:0.738025,time:128.000000</span><br><span class="line">voltage:0.943304,time:128.000000</span><br><span class="line">voltage:0.000000,time:144.000000</span><br><span class="line">voltage:0.000000,time:136.000000</span><br><span class="line">voltage:0.000000,time:120.000000</span><br></pre></td></tr></table></figure>
<p>两个读取之间的间隔基本都在100us左右，那么它的更新频率就是1000HZ左右
<span class="math display"><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -1.914ex;" xmlns="http://www.w3.org/2000/svg" width="22.207ex" height="4.95ex" role="img" focusable="false" viewbox="0 -1342 9815.7 2188"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mn" transform="translate(2185.6,676)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mrow" transform="translate(220,-824)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)"/><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1000,0)"/></g><g data-mml-node="mo" transform="translate(1722.2,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"/></g><g data-mml-node="msup" transform="translate(2444.4,0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)"/></g><g data-mml-node="TeXAtom" transform="translate(1033,393.1) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"/></g><g data-mml-node="mn" transform="translate(778,0)"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"/></g></g></g></g><rect width="4631.1" height="60" x="120" y="220"/></g><g data-mml-node="mo" transform="translate(5148.9,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mn" transform="translate(6204.7,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)"/><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1000,0)"/><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1500,0)"/></g><g data-mml-node="mi" transform="translate(8204.7,0)"><path data-c="1D43B" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 219 683Q260 681 355 681Q389 681 418 681T463 682T483 682Q499 682 499 672Q499 670 497 658Q492 641 487 638H485Q483 638 480 638T473 638T464 637T455 637Q416 636 405 634T387 623Q384 619 355 500Q348 474 340 442T328 395L324 380Q324 378 469 378H614L615 381Q615 384 646 504Q674 619 674 627T617 637Q594 637 587 639T580 648Q580 650 582 660Q586 677 588 679T604 682Q609 682 646 681T740 680Q802 680 835 681T871 682Q888 682 888 672Q888 645 876 638H874Q872 638 869 638T862 638T853 637T844 637Q805 636 794 634T776 623Q773 618 704 340T634 58Q634 51 638 51Q646 48 692 46H723Q729 38 729 37T726 19Q722 6 716 0H701Q664 2 567 2Q533 2 504 2T458 2T437 1Q420 1 420 10Q420 15 423 24Q428 43 433 45Q437 46 448 46H454Q481 46 514 49Q520 50 522 50T528 55T534 64T540 82T547 110T558 153Q565 181 569 198Q602 330 602 331T457 332H312L279 197Q245 63 245 58Q245 51 253 49T303 46H334Q340 38 340 37T337 19Q333 6 327 0H312Q275 2 178 2Q144 2 115 2T69 2T48 1Q31 1 31 10Q31 12 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"/></g><g data-mml-node="mi" transform="translate(9092.7,0)"><path data-c="1D44D" d="M58 8Q58 23 64 35Q64 36 329 334T596 635L586 637Q575 637 512 637H500H476Q442 637 420 635T365 624T311 598T266 548T228 469Q227 466 226 463T224 458T223 453T222 450L221 448Q218 443 202 443Q185 443 182 453L214 561Q228 606 241 651Q249 679 253 681Q256 683 487 683H718Q723 678 723 675Q723 673 717 649Q189 54 188 52L185 49H274Q369 50 377 51Q452 60 500 100T579 247Q587 272 590 277T603 282H607Q628 282 628 271Q547 5 541 2Q538 0 300 0H124Q58 0 58 8Z"/></g></g></g></svg></mjx-container></span>
但是我们正常的音频信号频率最低也都在8000HZ朝上，常见的都是16000HZ和44100HZ明显是远远满足不了需求的这就是为什么音频会听起来不正常的原因。</p>
<p>（当然也可以不适用Arduino自带的读取电压函数，调用更底层的ADC采样方法使用adc1_get_raw直接进行采样，这里我就不详细举例了，就信号的更新频率来说虽然快了一点，但是仍然满足不了音频信号的更新需求）</p>
<h2><span id="采用i2s传输协议优化adc采样">采用I2S传输协议优化ADC采样</span></h2>
<p>解决方案就是采用I2S传输协议去优化ADC采样。</p>
<p>之前的<strong>常规ADC</strong>采样的流程是：</p>
<p>ADC先进行采样，然后将采样后的数据存储到<strong>RAM</strong>中，然后CPU从RAM中提取数据，最后对数据进行处理从而得到相应的电压数据，在这个过程中ADC采样和CPU从RAM中获取数据这两个部分是<strong>不能同时进行</strong>的，</p>
<figure>
<img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20241126202646688.png" alt="image-20241126202646688">
<figcaption aria-hidden="true">image-20241126202646688</figcaption>
</figure>
<p>但是采用I2S传输协议优化ADC采样的流程是：</p>
<p>首先通过I2S协议采集麦克风的数据，然后将这份数据存储到DMA存储器中，通过DMA临时存储器来和RAM进行数据传递，这样就避免了RAM堵塞时ADC采样无法进行的问题，从而大大提高了ADC采样的效率</p>
<blockquote>
<p>这个DMA存储器可以理解成为一个临时存储站用来存储麦克风采集的数据（如果想要具体介绍，esp-idf官网有较为详细的介绍<a target="_blank" rel="noopener" href="https://docs.espressif.com/projects/esp-idf/zh_CN/stable/esp32/api-reference/system/mem_alloc.html">堆内存分配
- ESP32 - — ES P-IDF 编程指南 v5.2.3 文档</a>）</p>
</blockquote>
<figure>
<img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20241126203151787.png" alt="image-20241126203151787">
<figcaption aria-hidden="true">image-20241126203151787</figcaption>
</figure>
<h1><span id="系统搭建">系统搭建</span></h1>
<h2><span id="硬件部分">硬件部分</span></h2>
<p>整个系统由esp32-wroom32作为主控芯片，麦克风用的是inmp441（i2s麦克风）和max9814（adc采样麦克风）两种，音频增益芯片用的是max98357（I2S输出）和8002A功放芯片（DAC输出），喇叭市面上随便挑一个就好了</p>
<figure>
<img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20241206204650961.png" alt="image-20241206204650961">
<figcaption aria-hidden="true">image-20241206204650961</figcaption>
</figure>
<p>引脚接线如下：</p>
<p>ADC采样的引脚比较简单我就不说了哈哈哈哈</p>
<p><strong>INMP441引脚</strong></p>
<p>VDD——3.3V</p>
<p>GND，L/R——GND</p>
<p>SD——GPIO32</p>
<p>WS——GPIO22</p>
<p>SCK——GPIO21</p>
<p><strong>MAX98357引脚</strong></p>
<p>VIN——3.3V</p>
<p>GND——GND</p>
<p>DIN——GPIO14</p>
<p>BCLK——GPIO12</p>
<p>LRC——GPIO13</p>
<hr>
<h2><span id="软件部分">软件部分</span></h2>
<h3><span id="i2s协议配置">I2S协议配置</span></h3>
<p>i2s的参数配置</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">i2s_config_t</span> i2s_config = {</span><br><span class="line">    .mode = mode,<span class="comment">//设置I2S的模式，为主机或者从机模式，发送或者接收模式</span></span><br><span class="line">    .sample_rate = SAMPLE_RATE,<span class="comment">//采样率设置</span></span><br><span class="line">    .bits_per_sample = I2S_BITS_PER_SAMPLE_16BIT,<span class="comment">//采样的比特数</span></span><br><span class="line">    .channel_format = I2S_CHANNEL_FMT_ONLY_LEFT,<span class="comment">//I2S的通道设置</span></span><br><span class="line">    .communication_format = (<span class="type">i2s_comm_format_t</span>)(I2S_COMM_FORMAT_I2S | I2S_COMM_FORMAT_I2S_MSB),</span><br><span class="line">    .intr_alloc_flags = ESP_INTR_FLAG_LEVEL1,</span><br><span class="line">    .dma_buf_count = <span class="number">8</span>,<span class="comment">//存储空间数量</span></span><br><span class="line">    .dma_buf_len = <span class="number">1024</span>,<span class="comment">//存储空间长度</span></span><br><span class="line">    .use_apll = <span class="number">0</span>,</span><br><span class="line">    .tx_desc_auto_clear = <span class="literal">true</span>,</span><br><span class="line">    .fixed_mclk = <span class="number">-1</span></span><br><span class="line">  };</span><br></pre></td></tr></table></figure>
<p>i2s的引脚配置</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">i2s_pin_config_t</span> pin_config;</span><br><span class="line"><span class="built_in">memset</span>(&amp;pin_config,<span class="number">0</span>,<span class="keyword">sizeof</span>(<span class="type">i2s_pin_config_t</span>));</span><br><span class="line">pin_config.bck_io_num = bckPin;<span class="comment">//时钟引脚</span></span><br><span class="line">pin_config.ws_io_num = wsPin;<span class="comment">//声道设置</span></span><br><span class="line">pin_config.data_in_num = dataInPin;<span class="comment">//数据输入引脚（麦克风设置引脚）</span></span><br><span class="line">pin_config.data_out_num = dataOutPin;<span class="comment">//数据输出引脚（扬声器设置引脚）</span></span><br></pre></td></tr></table></figure>
<p>i2s的引脚和参数驱动配置</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">if</span>(ESP_OK!=i2s_driver_install(i2s_num_, &amp;i2s_config, <span class="number">0</span>, <span class="literal">NULL</span>))</span><br><span class="line">  {</span><br><span class="line">    Serial.println(<span class="string">"install i2s driver failed"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">if</span>(ESP_OK!=i2s_set_pin(i2s_num_, &amp;pin_config))</span><br><span class="line">  {</span><br><span class="line">    Serial.println(<span class="string">"i2s set pin failed"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3><span id="adc模式下的i2s配置">ADC模式下的I2S配置</span></h3>
<p>i2s参数配置</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">i2s_config_t</span> i2s_config = {</span><br><span class="line">  .mode = (<span class="type">i2s_mode_t</span>)(I2S_MODE_MASTER | I2S_MODE_RX | I2S_MODE_ADC_BUILT_IN),<span class="comment">//跟之前代码主要不同的就是要设置ADC的模式</span></span><br><span class="line">  .sample_rate = SAMPLE_RATE,</span><br><span class="line">  .bits_per_sample = BPS,</span><br><span class="line">  .channel_format = I2S_CHANNEL_FMT_RIGHT_LEFT,</span><br><span class="line">  .communication_format = (<span class="type">i2s_comm_format_t</span>)(I2S_COMM_FORMAT_I2S | I2S_COMM_FORMAT_I2S_MSB),</span><br><span class="line">  .intr_alloc_flags = <span class="number">0</span>,</span><br><span class="line">  .dma_buf_count = <span class="number">16</span>,</span><br><span class="line">  .dma_buf_len = <span class="number">128</span>,</span><br><span class="line">  .use_apll = <span class="literal">false</span></span><br><span class="line">};</span><br></pre></td></tr></table></figure>
<p>i2s驱动配置</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(ESP_OK!=i2s_driver_install(I2S_NUM_0, &amp;i2s_config, <span class="number">0</span>, <span class="literal">NULL</span>))</span><br><span class="line">  {</span><br><span class="line">    Serial.println(<span class="string">"install i2s driver failed"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  }</span><br><span class="line"> i2s_set_pin(I2S_NUM_0, <span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure>
<p>ADC配置</p>
<p>这里需要注意，如果你的项目中有WI-FIi功能的话建议不要使用ADC2的采样通道，因为ADC2采样通道和芯片中的WI-FI冲突了，</p>
<p><img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20241206203219502.png" alt="image-20241206203219502">具体可以参考esp32的官方文档<a target="_blank" rel="noopener" href="https://www.espressif.com/sites/default/files/documentation/esp32_datasheet_cn.pdf">esp32_datasheet_cn.pdf</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i2s_set_adc_mode(ADC_UNIT_1, adcChannel);<span class="comment">//设置ADC采样的通道为1，</span></span><br><span class="line">adc1_config_channel_atten(adcChannel, ADC_ATTEN_DB_11);</span><br><span class="line">i2s_adc_enable(I2S_NUM_0);</span><br></pre></td></tr></table></figure>
<p>主程序这里太多了就不放出来了参考<a target="_blank" rel="noopener" href="https://github.com/eejhongxin/esp32_I2S_or_adc_audioplay">eejhongxin/esp32_I2S_or_adc_audioplay</a></p>
<blockquote>
<p>参考资料：</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1xA411Q76y/?spm_id_from=333.337.search-card.all.click&amp;vd_source=3cb0bf4d59cb1d9d4ad468ab211ce85f">32
ESP32之使用I2S实现录音功能 （INMP411,MAX4466介绍）</a></p>
<p>https://www.youtube.com/watch?v=pPh3_ciEmzs</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://eejhongxin.github.io/2024/11/10/%E7%94%B5%E6%BA%90%E7%94%B5%E8%B7%AF%E8%AE%BE%E8%AE%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="eejhx">
      <meta itemprop="description" content="见你潜入深海，伴我匿于人间">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="嵌入小屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/11/10/%E7%94%B5%E6%BA%90%E7%94%B5%E8%B7%AF%E8%AE%BE%E8%AE%A1/" class="post-title-link" itemprop="url">电源电路设计</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-11-10 18:37:50" itemprop="dateCreated datePublished" datetime="2024-11-10T18:37:50+08:00">2024-11-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2026-01-17 21:26:33" itemprop="dateModified" datetime="2026-01-17T21:26:33+08:00">2026-01-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%A1%AC%E4%BB%B6%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index"><span itemprop="name">硬件设计</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://eejhongxin.github.io/2024/04/06/linux%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="eejhx">
      <meta itemprop="description" content="见你潜入深海，伴我匿于人间">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="嵌入小屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/04/06/linux%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" class="post-title-link" itemprop="url">linux应用开发基础知识</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-04-06 20:25:49" itemprop="dateCreated datePublished" datetime="2024-04-06T20:25:49+08:00">2024-04-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2026-01-17 21:26:33" itemprop="dateModified" datetime="2026-01-17T21:26:33+08:00">2026-01-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>14</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1><span id="linux应用开发基础知识">linux应用开发基础知识</span></h1>
<p>s</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://eejhongxin.github.io/2024/04/02/linux%E6%93%8D%E4%BD%9C%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="eejhx">
      <meta itemprop="description" content="见你潜入深海，伴我匿于人间">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="嵌入小屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/04/02/linux%E6%93%8D%E4%BD%9C%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4/" class="post-title-link" itemprop="url">linux操作常用指令</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-04-02 18:24:49" itemprop="dateCreated datePublished" datetime="2024-04-02T18:24:49+08:00">2024-04-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2026-01-17 21:26:33" itemprop="dateModified" datetime="2026-01-17T21:26:33+08:00">2026-01-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>[!NOTE]</p>
<p>本篇内容仅仅是记录本人学习llinux基础命令的过程，文章的内容来自<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1w4411B7a4?p=1&amp;vd_source=3cb0bf4d59cb1d9d4ad468ab211ce85f">韦东山b站linux学习</a>，如有侵权立即删除</p>
</blockquote>
<h1><span id="linux操作常用指令">Linux操作常用指令</span></h1>
<p>快捷调取命令行：<code>ctrl+alt+T</code></p>
<figure>
<img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240402185534400.png" alt="image-20240402185534400">
<figcaption aria-hidden="true">image-20240402185534400</figcaption>
</figure>
<h2><span id="目录和文件操作命令">目录和文件操作命令</span></h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pwd	 	<span class="comment">#显示当前所在的目录</span></span><br><span class="line">ls   	<span class="comment">#显示当前目录下的文件 </span></span><br><span class="line">ls -a	<span class="comment">#显示隐藏文件</span></span><br><span class="line">cd .. 	<span class="comment">#返回到上一级的路径</span></span><br><span class="line">mkdir	<span class="comment">#新建目录</span></span><br><span class="line">rmdir 	<span class="comment">#删除目录 </span></span><br><span class="line">rm 目标路径 -r <span class="comment">#删除指定目标路径 </span></span><br><span class="line">touch 	<span class="comment">#新建文件</span></span><br><span class="line">cp 		<span class="comment">#复制文件</span></span><br><span class="line">rm 		<span class="comment">#删除文件</span></span><br><span class="line">cat 	<span class="comment">#将文件内容显示到终端中</span></span><br><span class="line">clear 	<span class="comment">#清除屏幕显示内容</span></span><br><span class="line"></span><br><span class="line">cat 	<span class="comment">#显示文件内容</span></span><br><span class="line">touch 	<span class="comment">#修改文件时间</span></span><br></pre></td></tr></table></figure>
<h2><span id="文件的权限和属性修改">文件的权限和属性修改</span></h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line">![image-20240402202513890](https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240402202513890.png)</span><br><span class="line"></span><br><span class="line">### chmod 改变文件权限</span><br><span class="line"></span><br><span class="line">![image-20240402202545754](https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240402202545754.png)</span><br><span class="line"></span><br><span class="line">### chown改变文件所有者</span><br><span class="line"></span><br><span class="line">![image-20240402202806266](https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240402202806266.png)</span><br><span class="line"></span><br><span class="line">![image-20240402203249857](https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240402203249857.png)	</span><br><span class="line"></span><br><span class="line">## 查找搜索文件</span><br><span class="line"></span><br><span class="line"> ```python</span><br><span class="line"> #find用法</span><br><span class="line"> find （指定文件路径） -name 查找的文件</span><br><span class="line"> </span><br><span class="line"> #grep用法</span><br><span class="line"> grep &quot;查找内容&quot; * 		#查找所有符合条件文件行数</span><br><span class="line"> grep &quot;查找内容&quot; * -n	#显示文件的行数</span><br><span class="line"> grep &quot;查找内容&quot; * -nw	#查找的内容是整词（即完全符合）</span><br><span class="line"> grep &quot;查找内容&quot; * -nwr	#递归查找（包含子文件夹）</span><br></pre></td></tr></table></figure>
<h2><span id="压缩和解压缩命令">压缩和解压缩命令</span></h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#压缩文件</span></span><br><span class="line">tar czf <span class="string">&quot;打包后的压缩文件包名.tar.gz&quot;</span> <span class="string">&quot;打包的文件夹&quot;</span> </span><br><span class="line">tar cjf <span class="string">&quot;打包后的压缩文件包名.tar.bz2&quot;</span> <span class="string">&quot;打包的文件夹&quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#解压文件</span></span><br><span class="line">tar xzf <span class="string">&quot;打包后的压缩文件包名.tar.gz&quot;</span> <span class="string">&quot;打包的文件夹&quot;</span> </span><br><span class="line">tar xjf <span class="string">&quot;打包后的压缩文件包名.tar.bz2&quot;</span> <span class="string">&quot;打包的文件夹&quot;</span> </span><br></pre></td></tr></table></figure>
<figure>
<img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240403153248471.png" alt="image-20240403153248471">
<figcaption aria-hidden="true">image-20240403153248471</figcaption>
</figure>
<h2><span id="vi编辑器">VI编辑器</span></h2>
<h3><span id="新建-保存-取消保存">新建、保存、取消保存</span></h3>
<figure>
<img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240403153734163.png" alt="image-20240403153734163">
<figcaption aria-hidden="true">image-20240403153734163</figcaption>
</figure>
<h3><span id="移动">移动</span></h3>
<figure>
<img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240403154414236.png" alt="image-20240403154414236">
<figcaption aria-hidden="true">image-20240403154414236</figcaption>
</figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://eejhongxin.github.io/2024/04/02/%E5%9F%BA%E4%BA%8ETCP%E7%9A%84%E6%B5%81%E5%AA%92%E4%BD%93%E8%A7%86%E9%A2%91%E9%9F%B3%E9%A2%91%E5%8A%A0%E5%AF%86%E4%BC%A0%E8%BE%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="eejhx">
      <meta itemprop="description" content="见你潜入深海，伴我匿于人间">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="嵌入小屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/04/02/%E5%9F%BA%E4%BA%8ETCP%E7%9A%84%E6%B5%81%E5%AA%92%E4%BD%93%E8%A7%86%E9%A2%91%E9%9F%B3%E9%A2%91%E5%8A%A0%E5%AF%86%E4%BC%A0%E8%BE%93/" class="post-title-link" itemprop="url">基于TCP的流媒体视频音频加密传输</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-04-02 15:35:23" itemprop="dateCreated datePublished" datetime="2024-04-02T15:35:23+08:00">2024-04-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2026-01-17 21:26:33" itemprop="dateModified" datetime="2026-01-17T21:26:33+08:00">2026-01-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python%E9%A1%B9%E7%9B%AE/" itemprop="url" rel="index"><span itemprop="name">python项目</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>154</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1><span id="基于tcp的流媒体视频音频加密传输">基于TCP的流媒体视频音频加密传输</span></h1>
<h2><span id="项目实现功能">项目实现功能</span></h2>
<p>​
完成音频和视频（二者必须皆有）的采集、加密或加水印、传输、解密或提取水印、存储（必须基于数据库），要求基于文献复现一种音频和视频水印或加密技术（音频和视频各一种技术），并集成到软件中，设计报告中需要给出2种技术的细节。此外，要求可以实时视频语音聊天。</p>
<h2><span id="目的及意义">目的及意义</span></h2>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://eejhongxin.github.io/2024/03/26/%E5%8D%95%E7%82%B9%E9%87%87%E9%9B%86%E6%B8%A9%E6%B9%BF%E5%BA%A6%E6%98%BE%E7%A4%BA%E5%8F%8A%E4%BA%91%E7%AB%AF%E5%8F%AF%E8%A7%86%E5%8C%96%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="eejhx">
      <meta itemprop="description" content="见你潜入深海，伴我匿于人间">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="嵌入小屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/03/26/%E5%8D%95%E7%82%B9%E9%87%87%E9%9B%86%E6%B8%A9%E6%B9%BF%E5%BA%A6%E6%98%BE%E7%A4%BA%E5%8F%8A%E4%BA%91%E7%AB%AF%E5%8F%AF%E8%A7%86%E5%8C%96%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/" class="post-title-link" itemprop="url">单点采集温湿度显示及云端可视化数据同步</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-03-26 10:04:25" itemprop="dateCreated datePublished" datetime="2024-03-26T10:04:25+08:00">2024-03-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2026-01-17 21:26:33" itemprop="dateModified" datetime="2026-01-17T21:26:33+08:00">2026-01-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/51%E5%8D%95%E7%89%87%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">51单片机</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>9.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>8 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->
<ul>
<li><a href="#系统功能">系统功能</a></li>
<li><a href="#原理框图及说明">原理框图及说明</a></li>
<li><a href="#主要电路说明-元件选择及参数计算">主要电路说明、元件选择及参数计算</a>
<ul>
<li><a href="#复位与振荡电路">复位与振荡电路</a></li>
<li><a href="#显示电路">显示电路</a></li>
<li><a href="#按键电路">按键电路</a></li>
<li><a href="#温度湿度检测电路">温度湿度检测电路</a></li>
<li><a href="#esp8266wifi模块">ESP8266WIFI模块</a></li>
<li><a href="#eeprom电路">EEPROM电路</a></li>
</ul></li>
<li><a href="#总电路设计">总电路设计</a></li>
<li><a href="#软件设计思路及框图">软件设计思路及框图</a>
<ul>
<li><a href="#软件设计思路及主流程图">软件设计思路及主流程图</a></li>
<li><a href="#延时模块">延时模块</a></li>
<li><a href="#lcd12864显示模块"><code>LCD12864</code>显示模块</a></li>
<li><a href="#按键扫描模块">按键扫描模块</a></li>
<li><a href="#dht11传感器数据获取模块">DHT11传感器数据获取模块</a></li>
<li><a href="#显示温度界面">显示温度界面</a></li>
<li><a href="#esp8266wifi发送模块">ESP8266WIFI发送模块</a></li>
<li><a href="#eeprom断电不丢失模块">EEPROM断电不丢失模块</a></li>
</ul></li>
<li><a href="#结果及测试分析">结果及测试分析</a>
<ul>
<li><a href="#硬件电路">硬件电路</a></li>
<li><a href="#测试记录及结果分析">测试记录及结果分析</a></li>
</ul></li>
</ul>
<!-- tocstop -->
<h1><span id="系统功能">系统功能</span></h1>
<p>通过温湿度传感器DHT11采集温、湿度，能够通过显示单元显示出温、湿度，并控制继电器。<br>
1. 开机液晶屏上显示姓名、学号3秒。<br> 2.
显示当前温、湿度和设定的温度、湿度上下限。<br>  
温度测量范围：<code>0℃~50℃</code><br>  
温度测量误差：<code>±2℃</code><br>  
湿度测量范围：<code>20%~95%</code><br>  
湿度测量误差： <code>±5%</code><br>  
测量精度：<code>±1℃，±1%</code><br>   测量数值均为整数<br> 3.
当温度或者湿度超过上下限时启动继电器带动风扇。<br> 4.
可以通过矩阵键盘调节温度、湿度上下限。<br>  
可调控温度范围：<code>1℃~99℃</code><br>  
可调控湿度范围：<code>1%~99%</code><br> 5.
温度、湿度上下限设置后断电不丢失。<br> 6.
通过ESP8266模块连接WIFI上传数据至onenet物联网平台，并进行可视化展示。<br>
7.
单片机与上位机进行通信，通过单片机上位机实时显示获取到的温湿度数据。<br>
8. 通过微信小程序在后台对温度、湿度信息进行监测。<br></p>
<hr>
<h1><span id="原理框图及说明">原理框图及说明</span></h1>
<p><strong>测量原理</strong></p>
根据设计任务，设计如下框图：<br>
<center>
<img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="https://s21.ax1x.com/2024/03/26/pF5Bs8x.png"> <br>
<div style="color:orange; border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">
原理框图
</div>
</center>
<ul>
<li><strong>主控单元</strong>，主要负责从DHT11传感器中获取温度、湿度信息，获取矩阵键盘的设置温湿度信息，并将设置的温湿度信息和温湿度上下限显示在液晶显示模块上，并通过RX、TX串口发送数据到上位机以及ESP8266WIFI模块中去，便于向云平台传输数据。当温度或者湿度超过设定的温湿度阈值时，主控单元通过控制设置的继电器引脚电平带动直流电机工作。<br></li>
<li><strong>电源部分</strong>，为单片机提供5V稳压电源和3.3V稳压电源。<br></li>
<li><strong>矩阵键盘部分</strong>，其中K1~K9键盘用来设置温度湿度阈值，K13和K14按键可以用来设置单片机的显示界面和发送数据界面。<br></li>
<li><strong>独立按键部分</strong>，其中K1~K4分别代表温度上限、温度下限、湿度上限、湿度下限四个部分的设置。<br></li>
<li><strong>液晶显示模块</strong>，用来显示初始界面（基本信息显示3s）、设置温度界面、显示温度界面、温度上下限、发送数据界面。<br></li>
<li><strong>EEPROM电路</strong>，用来存储设置的温度湿度上下限信息，当突然断电时，保存信息，当下次通电时，读取上次设置的温湿度信息并且展示液晶显示模块上。<br></li>
<li><strong>WIFI模块</strong>，用来接收DHT11温度传感器获取到的温湿度数据并通过AT指令发送给网址和指定的设备。<br></li>
<li><strong>晶振电路以及时钟电路</strong>：晶振电路主要是用来提供一个固定频率的脉冲方便时钟电路计时；时钟电路主要是用来为第一个功能的3s钟进行计时，以及为后面的显示模块刷新率进行设置。<br></li>
</ul>
<p><strong>使用说明</strong></p>
<ol type="1">
<li>首先打开单片机电源，烧录编写好的程序<br></li>
<li>单片机显示模块会显示开机页面即姓名、学号信息3s。<br></li>
<li>3s之后会进入温度和湿度设置界面，通过独立键盘模块<code>K1~K4</code>次选择温度下限、温度上限、湿度下限、湿度上限并通过矩阵键盘K1~K9进行按键设置。如果出现设置错误的情况只需要再通过独立键盘选择错误的设置参数并通过矩阵键盘重新设置即可。</li>
<li>当温湿度阈值设置完成后，按下矩阵键盘K13即可进入温湿度显示模块，该模块会显示当前的温湿度信息和设置的温湿度上下限。<br></li>
<li>按下矩阵键盘的K14即可把温湿度信息发送到OneNet云平台进行数据存储和可视化展示并实时同步到微信小程序平台进行后台监测。<br></li>
<li>连接上usb上位机即可实时显示获取的温湿度数据。<br></li>
<li>当温度和湿度超过设定的上下限时，启动继电器带动直流电机工作。<br></li>
<li>当整个系统断电后，再次打开单片机系统会自动保存之前设置的温度和湿度上下限。<br></li>
</ol>
<table style="width:15%;">
<colgroup>
<col style="width: 15%">
</colgroup>
<tbody>
<tr>
<td># 主要电路说明、元件选择及参数计算</td>
</tr>
<tr>
<td>| 内部模块 | 数量 | | :--------------: | :----: | | 核心芯片STC89C52
| 1 | | 电容 | 若干个 | | 杜邦线 | 若干个 | | USB转串口 | 1 | | 3.3V
5V供电模块 | 6 | | 按键 | 4 | | 72M 晶振 | 1 | | 矩阵键盘模块 | 1 | |
24CO2 芯片 | 1 |</td>
</tr>
<tr>
<td>| 外部资料 | 数量 | | :--------------: | :--: | | DHT11 温湿度传感器
| 1 | | ESP8266WIFI模块 | 1 | | 直流电机 | 1 | | 1路 5V继电器 | 1 |</td>
</tr>
<tr>
<td>## 复位与振荡电路
复位电路如下图所示，由C14和R9构成。由于51单片机为低电平复位，图示电路利用电容的特性，在刚刚外加5V电源时RST脚的电压为低。时间常数=RC=1000mS，满足芯片复位要求。由于电压为5V，可选择耐压6.3V的电解电容即可。<br></td>
</tr>
<tr>
<td><img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240327143812219.png" alt="image-20240327143812219"></td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>振荡电路按照说明书的推荐，选择12MHz晶体，C7、C8选择33pF瓷片电容。</td>
</tr>
<tr>
<td><img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240327143825064.png" alt="image-20240327143825064"></td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>## 显示电路</td>
</tr>
<tr>
<td>经过大量的测试和调研，最终我的显示元件选择20引脚的12864液晶显示屏（128X64显示分辨率为128×64，内置8192个16<em>16点汉字，和128个16</em>8点ASCII字符集。利用该模块灵活的接口方式和简单、方便的操作指令。可以显示8×4行16×16点阵的汉字。也可完成图形显示），这里把各个引脚的功能以及连接方式做成了一个表格，以便直观地显示，通过51单片机上自带的可调电阻来调节12864的背光。</td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>| GND | +5V | V_com | RS | R/W | EN | D0 | D1 | D2 | D3 | |
:----------: | :------------: | :---------------: |
:---------------------: | :----------------: | :------------: | :---: |
:---: | :---: | :---: | | 模块的电源地 | 模块的电源正端 |
LCD驱动电压输入端 | 并行的指令/数据选择信号 | 并行的读写选择信号 |
并行的使能信号 | 数据0 | 数据1 | 数据0 | 数据0 | | GND | VCC | 电位器 |
P2^6 | P2^5 | P2^7 | P0^0 | P0^1 | P0^2 | P0^3 |</td>
</tr>
<tr>
<td>| D4 | D5 | D6 | D7 | PSB | NC | RST | V_OUT | BLA+ | BLA- | | :---:
| :---: | :---: | :---: | :-------------: | :--: | :-------------: |
:---: | :--------: | :----------: | | 数据4 | 数据5 | 数据6 | 数据7 |
并/串行接口选择 | 空脚 | 复位 低电平有效 | 空脚 | 背光源正极 |
背光源和负极 | | P0^4 | P0^5 | P0^6 | P0^7 | P3^2 | | VCC | | VCC | GND
|</td>
</tr>
<tr>
<td><img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedwps13.jpg"></td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>## 按键电路</td>
</tr>
<tr>
<td>由于89C52的P3口内部有上拉电阻，为简化电路，即当K1没有按下时，P3.1=1，当K1按下时，P3.1=0。<br></td>
</tr>
<tr>
<td>矩阵键盘本质是使用8个io口来进行16个按键的控制读取，可以减小io口的使用，用4条I/O线作为行线，4条I/O线作为列线组成的键盘。在行线和列线的每个交叉点上，设置一个按键。而这样的按键中按键的个数是4
X
4个。第一行接到p17，第二行接到p16，第三行接到p15，第4行接到p14，第一列接到p13，第二列接到p12，第三列接到p11，第四列接到p10。先从P1口的高四位（四个行）输出高电平，低四位（四个列）输出低电平，假设有按键按下，从P1口的高四位读取键盘状态。判断高四位的四行哪一行变成了低电平，就知道是第几行，再从P1口的低四位（四个列）输出高电平，高四位（四个行）输出低电平，从P1口的低四位读取键盘状态。判断低四位的四列哪一行变成了低电平，就知道是第几列，将两次读取结果组合起来就可以得到当前按键的特征编码。</td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>| K1 | K2 | K3 | K4 | | ---- | ---- | ---- | ---- | | P3.1 | P3.0 |
P3.2 | P3.3 |</td>
</tr>
<tr>
<td><img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedwps14.jpg"></td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td><img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240327143902820.png" alt="image-20240327143902820"></td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>## 温度湿度检测电路</td>
</tr>
<tr>
<td><img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240327144442514.png" alt="image-20240327144442514"></td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>经过大量的测试和我们所有的知识储备，最终我选择DHT11模块对温度，湿度进行检测并显示在12864显示器上。DHT的引脚图如下所示。
<br></td>
</tr>
<tr>
<td>DHT11共有三个引脚，其中VCC，GND分别接入单片机电源模块上的VCC,GND。程序初始化后，单片机首先向DATA管脚发送一个低电平脉冲.</td>
</tr>
<tr>
<td><strong>触发DHT11采集数据</strong></td>
</tr>
<tr>
<td>总线空闲状态为高电平,单片机把总线拉低等待DHT11响应,单片机把总线拉低必须大于18ms,保证DHT11能检测到起始信号。</td>
</tr>
<tr>
<td>当DHT11接收到单片机的开始信号后,等待单片机开始信号结束,然后发送80us低电平响应信号。</td>
</tr>
<tr>
<td>单片机发送开始信号结束后,延时等待20-40us后,切换为输入状态，等待DHT11的80us低电平信号结束，然后判断DHT11是否是否发出
80us 的高电平；如果是，即可开始采集数据。</td>
</tr>
<tr>
<td><img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240327144815458.png" alt="image-20240327144815458"></td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td><strong>数字0和1的信号时序</strong></td>
</tr>
<tr>
<td>当DHT11输出数字0时， 单片机读取到的信号为50 us的低电平，之后为26-28
us的高电平。当DHT11输出数字1时， 单片机读取到的信号为50
us的低电平，之后为70 us的高电平。</td>
</tr>
<tr>
<td><img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240329171431160.png" alt="image-20240329171427862"></td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td><img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240329171440210.png" alt="image-20240329171440210"></td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td><strong>总时序图</strong></td>
</tr>
<tr>
<td>用户MCU发送一次开始信号后,DHT11从低功耗模式转换到高速模式,等待主机开始信号结束后,DHT11发送响应信号,送出40bit的数据,并触发一次信号采集,用户可选择读取部分数据。</td>
</tr>
<tr>
<td>从模式下,DHT11接收到开始信号触发一次温湿度采集,如果没有接收到主机发送开始信号,DHT11不会主动进行温湿度采集。当一次完整的采集数据后，DHT11会转换到低速模式。</td>
</tr>
<tr>
<td><img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240329171538449.png" alt="image-20240329171538449"></td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>## ESP8266WIFI模块</td>
</tr>
<tr>
<td>ESP8266是一款高性能的WIFI串口模块，内部集成<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=MCU&amp;spm=1001.2101.3001.7020">MCU</a>能实现单片机之间串口通信，是目前使用最广泛的一种WIFI模块之一。接线时只需要将RXD、TXD、GND、VCC这4个引脚，分别和USB转TTL模块的TXD、RXD、GND、VCC相连接。</td>
</tr>
<tr>
<td><img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240329171640275.png"></td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>然后再通过USB转TTL模块和AT指令集通过以下步骤在串口助手中或者直接在单片机程序中对ESP8266模块进行配置。</td>
</tr>
<tr>
<td>1. AT——测试ESP8266是否工作完好 2.
AT+CWMODE=1——设置ESP8266的工作模式为Station模式 3.
AT+CWJAP=”WIFI名称,”WIFI密码”——进行WIFI连接（注意这里的手机热点或者外部热点只能是英文名称）
4. AT+CIPSTART=”TCP”,”
你电脑自己的IP地址”,”设置的端口”——建立TCP连接，设置IP地址和PORT端口。 5.
AT+CIPMODE=1——开启ESP8266的透传模式。 6. AT+CIPSEND——准备发送数据 7.
POST /devices/1051580320/datapoints?type=3 HTTP/1.1 ——onenet的设备</td>
</tr>
<tr>
<td>api-key:1ZXQyfKnqL1bqEV0D0JJqbL7pmc= ——onenet的master key</td>
</tr>
<tr>
<td>Host:api.heclouds.com ——onenet的主机ip地址</td>
</tr>
<tr>
<td>Content-Length:21 ——传输的数据长度</td>
</tr>
<tr>
<td>{"temp":temp,"humi":humi} ——传输的数据</td>
</tr>
<tr>
<td><img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240329173732911.png" alt="image-20240329173732911"></td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>## EEPROM电路</td>
</tr>
<tr>
<td>EEPROM电路的主要部分为AT24C02，原理图如下所示。</td>
</tr>
<tr>
<td><img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240329172256085.png" alt="image-20240329172256085"></td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>AT24C02 器件地址为 7 位，高 4 位固定为 1010，低 3 位由 A0/A1/A2
信号线的电平决定。
因为传输地址或数据是以字节为单位传送的，当传送地址时，器件地址占 7
位，还有最后一位（最低位 R/W）用来选择读写方向。 A0/A1/A2 默认连接到
GND，所以器件地址为1010000，即
0x50（未计算最低位）。如果要对芯片进行写操作时，R/W 即为
0，写器件地址即为 0XA0；如果要对芯片进行读操作时，R/W 即为
1，此时读器件地址为 0XA1。开发板上我们也将 WP 引脚直接接在 GND
上，此时芯片允许数据正常读写。</td>
</tr>
<tr>
<td><img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240329172539074.png" alt="image-20240329172539074"></td>
</tr>
<tr>
<td></td>
</tr>
</tbody>
</table>
<h1><span id="总电路设计">总电路设计</span></h1>
<figure>
<img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240329172640045.png" alt="image-20240329172640045">
<figcaption aria-hidden="true">image-20240329172640045</figcaption>
</figure>
<center style="color:#C0C0C0;text-decoration:underline">
总电路硬件连接图
</center>
<figure>
<img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240329172701440.png" alt="image-20240329172701440">
<figcaption aria-hidden="true">image-20240329172701440</figcaption>
</figure>
<center style="color:#C0C0C0;text-decoration:underline">
总电路硬件实物图
</center>
<hr>
<h1><span id="软件设计思路及框图">软件设计思路及框图</span></h1>
<h2><span id="软件设计思路及主流程图">软件设计思路及主流程图</span></h2>
<p>根据题目的设计要求以及我自己附加的功能，我采用定时器0和定时器1作为时钟数据源，定时器0每用来完成功能1姓名学号显示3s，定时器1用来对ESP8266和II2C进行初始化并实现发送数据、存储数据以及初始化数据线的功能。设置温湿度、显示温湿度信息和上下限、继电器以及直流电机的工作、矩阵键盘扫描、比较当前数据和设定阈值的差别、发送温湿度数据等全部放在主程序中实现。</p>
<p>温湿度获取部分设置数据缓冲区，DHT11传感器获取的温湿度信息直接送入缓冲区，由程序完成动态扫描。</p>
<p><strong>设计的全局变量</strong></p>
<ol type="1">
<li>温湿度数据缓冲区：<code>uchar wendu[4]、uchar shidu[4]</code></li>
<li>设置的温湿度上下限：<code>uchar temtop[4]、uchar temlow[4]、uchar humtop[4]、uchar humlow[4]</code></li>
<li>温湿度传感器接收数据：<code>uchar rec_dat[9]</code></li>
<li>矩阵键盘的扫描值<code>char key、uint flag</code></li>
<li>独立键盘的扫描值：<code>uchar func</code></li>
<li>ESP8266接收状态标记：<code>uint UART_RX_STA</code></li>
<li>ESP8266接收缓冲：<code>uchar UART_RX_BUF[UART_REC_LEN]</code></li>
</ol>
<p><strong>设计的端口</strong></p>
<ol type="1">
<li>LCD端口</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sbit LCD_RS  =  P2^<span class="number">6</span>;       <span class="comment">//寄存器选择输入</span></span><br><span class="line">sbit LCD_RW  =  P2^<span class="number">5</span>;       <span class="comment">//液晶读/写控制</span></span><br><span class="line">sbit LCD_EN  =  P2^<span class="number">7</span>;       <span class="comment">//液晶使能控制</span></span><br><span class="line">sbit LCD_PSB =  P3^<span class="number">2</span>;       <span class="comment">//串/并方式控制</span></span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>DHT11端口</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sbit Data=P3^<span class="number">6</span>;</span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li>继电器端口</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sbit wind=P2^<span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<ol start="4" type="1">
<li>蜂鸣器端口</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sbit beep=P2^<span class="number">5</span>;</span><br></pre></td></tr></table></figure>
<p><strong>定义的端口</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_data  P0   ——LCD数据口</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> keyboard  P1   ——定义矩阵键盘</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> UART_REC_LEN  10  ——定义ESP8266最大接收字节数</span></span><br></pre></td></tr></table></figure>
<p><strong>函数设计</strong></p>
<ol type="1">
<li>主函数main()</li>
</ol>
<p>入口：无，出口：无。 一个大的循环，程序用不结束。</p>
<ol start="2" type="1">
<li>ESP8266发送数据 void send_data()</li>
</ol>
<p>功能：对ESP8266进行云平台连接并通过ESP8266发送获取的DHT11温湿度传感器获取的数据。</p>
<p>入口：无，出口：无0</p>
<ol start="3" type="1">
<li>初始化定时器0 void time1_init(void)</li>
</ol>
<p>功能：初始化定时器的工作模式，并对定时器0赋初值。</p>
<p>​ 入口：无，出口：无。 改动当前显示位号。</p>
<ol start="4" type="1">
<li>定时器的中断函数 void time0() interrupt 1</li>
</ol>
<p>功能：通过设置count计数变量，每1mS中断一次，记录中断次数到3000次则初始化页面跳转至设置温度界面，并调整为合法的时间格式。</p>
<p>入口：无，出口：无。</p>
<figure>
<img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240401172731304.png" alt="image-20240401172731304">
<figcaption aria-hidden="true">image-20240401172731304</figcaption>
</figure>
<center style="color:#C0C0C0;text-decoration:underline">
主程序框图
</center>
<h2><span id="延时模块">延时模块</span></h2>
<p><strong>函数设计</strong></p>
<ol type="1">
<li>void delay_ms(uint ms)</li>
</ol>
<p>功能：设置延迟ms的函数</p>
<p>入口：延迟的时间，出口：无</p>
<ol start="2" type="1">
<li>void delay(int ms)</li>
</ol>
<p>功能：设置延迟ms的函数</p>
<p>入口：延迟的ms时间 出口：无</p>
<ol start="3" type="1">
<li>void delay_us(uchar n)</li>
</ol>
<p>功能：设置延迟的us的函数</p>
<p>入口：延迟us的函数 出口：无</p>
<figure>
<img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240401173024832.png" alt="image-20240401173024832">
<figcaption aria-hidden="true">image-20240401173024832</figcaption>
</figure>
<center style="color:#C0C0C0;text-decoration:underline">
延时实现
</center>
<h2><span id="lcd12864显示模块"><code>LCD12864</code>显示模块</span></h2>
<ol type="1">
<li>设计的端口值</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bit LCD_RS  =  P2^<span class="number">6</span>;       <span class="comment">//寄存器选择输入</span></span><br><span class="line">sbit LCD_RW  =  P2^<span class="number">5</span>;       <span class="comment">//液晶读/写控制</span></span><br><span class="line">sbit LCD_EN  =  P2^<span class="number">7</span>;       <span class="comment">//液晶使能控制</span></span><br><span class="line">sbit LCD_PSB =  P3^<span class="number">2</span>;       <span class="comment">//串/并方式控制</span></span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>定义的端口值</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_data  P0       <span class="comment">//数据口</span></span></span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li>设计的函数如下</li>
</ol>
<ul>
<li>bit lcd_busy()</li>
</ul>
<p>功能：检查LCD忙状态</p>
<p>入口：无，出口：，lcd_busy为1时，忙，等待。lcd-busy为0时,闲，可写指令与数据。</p>
<ul>
<li>void lcd_wcmd(uchar cmd)</li>
</ul>
<p>功能：写指令数据到LCD</p>
<p>入口：LCD指令集 出口：无</p>
<ul>
<li>void lcd_wdat(uchar dat)</li>
</ul>
<p>功能：写显示数据到LCD</p>
<p>入口：写入的数据 出口：无</p>
<ul>
<li>lcd_init()</li>
</ul>
<p>功能：LCD初始化设定</p>
<p>入口：无 出口：无 调用函数：lcd_wcmd,lcd_busy()</p>
<ul>
<li>void lcd_showstring(uchar x,uchar y,uchar *str)</li>
</ul>
<p>功能：LCD根据设定的位置显示字符串</p>
<p>入口：设置的x轴和y轴，显示的字符串 出口：无
调用的函数：lcd_wdat(uchar dat)</p>
<figure>
<img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240401174447136.png" alt="image-20240401174447136">
<figcaption aria-hidden="true">image-20240401174447136</figcaption>
</figure>
<center style="color:#C0C0C0;text-decoration:underline">
lcd12864模块流程图
</center>
<h2><span id="按键扫描模块">按键扫描模块</span></h2>
<p><strong>定义的端口值</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> keyboard P1</span></span><br></pre></td></tr></table></figure>
<p><strong>函数设计</strong></p>
<p>uchar Keypress()</p>
<p>功能：扫描哪个按键按下了</p>
<p>入口：无，出口：按下的按键</p>
<h2><span id="dht11传感器数据获取模块">DHT11传感器数据获取模块</span></h2>
<p><strong>设计的全局变量</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uchar rec_dat[<span class="number">9</span>];</span><br></pre></td></tr></table></figure>
<p><strong>定义的端口</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sbit Data=P3^<span class="number">6</span>;</span><br></pre></td></tr></table></figure>
<p><strong>函数设计</strong></p>
<ol type="1">
<li>DHT11_start()</li>
</ol>
<p>功能：初始化DHT11温湿度传感器模块</p>
<p>入口：无，出口：无</p>
<ol start="2" type="1">
<li>DHT11_rec_byte()</li>
</ol>
<p>功能：DHT11接收获取到的字节数据</p>
<p>入口：无 出口：接收到的字节数据</p>
<ol start="3" type="1">
<li>DHT11_receive()</li>
</ol>
<p>功能：接收所有的温度湿度电平数据并进行转换</p>
<p>入口：无 出口：转换的温湿度数据</p>
<ol start="4" type="1">
<li>DHT11_temget()</li>
</ol>
<p>功能：把转换过的数据存进湿度和温度数组中去</p>
<p>入口：无 出口：无 调用函数：lcd_wcmd,lcd_busy()</p>
<figure>
<img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240401184513924.png" alt="image-20240401184513924">
<figcaption aria-hidden="true">image-20240401184513924</figcaption>
</figure>
<center style="color:#C0C0C0;text-decoration:underline">
DHT11温湿度传感器获取温度湿度
</center>
<h2><span id="显示温度界面">显示温度界面</span></h2>
<p><strong>设计的全局变量</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">uchar number[]=<span class="string">&quot;123456789&quot;</span>;  ——矩阵键盘的按下值</span><br><span class="line">uchar temtop[<span class="number">4</span>];  ——设置的温度上限值</span><br><span class="line">uchar temlow[<span class="number">4</span>];  ——设置的温度下限值</span><br><span class="line">uchar humtop[<span class="number">4</span>];  ——设置的湿度上限值</span><br><span class="line">uchar humlow[<span class="number">4</span>];  ——设置的湿度下限值</span><br><span class="line">uchar wendu[<span class="number">4</span>];  ——温度数据缓存值</span><br><span class="line">uchar shidu[<span class="number">4</span>];   ——湿度数据缓存值</span><br><span class="line">uint ttop,tlow,htop,hlow,tnow,hnow; ——把温度湿度上下限数组缓存值转化为十进制数</span><br></pre></td></tr></table></figure>
<p><strong>定义的端口</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sbit beep=P2^<span class="number">5</span>; ——蜂鸣器引脚</span><br><span class="line">sbit wind=P2^<span class="number">2</span>; ——继电器引脚</span><br></pre></td></tr></table></figure>
<p><strong>函数设计</strong></p>
<ol type="1">
<li>showtem()</li>
</ol>
<p>功能：显示当前温度和湿度</p>
<p>入口：无，出口：无</p>
<ol start="2" type="1">
<li>settem()</li>
</ol>
<p>功能：设置温湿度上下限</p>
<p>入口：无 出口：无</p>
<h2><span id="esp8266wifi发送模块">ESP8266WIFI发送模块</span></h2>
<p><strong>函数设计</strong></p>
<ol type="1">
<li>UART_Init(void)</li>
</ol>
<p>功能：初始化UART协议和定时器1</p>
<p>入口：无 出口：无</p>
<ol start="2" type="1">
<li>UART_SendData(uchar dat)</li>
</ol>
<p>功能：发送一个字符数据</p>
<p>入口：字符数据 出口：无</p>
<ol start="3" type="1">
<li>UART_SendString(uchar *pbuf)</li>
</ol>
<p>功能：发送一个字符串数据</p>
<p>入口：字符串数据 出口：无</p>
<ol start="4" type="1">
<li><p>ESP8266_SendCmd(uchar *pbuf)</p>
<p>功能：向ESP8266发送AT指令集</p>
<p>入口：AT指令，字符串格式，出口：无</p></li>
<li><p>ESP8266_SendData(uchar *pbuf)</p></li>
</ol>
<p>功能：ESP8266 WIFI发送数据到APP</p>
<p>入口：数据 出口：无</p>
<ol start="6" type="1">
<li>ESP8266_ModeInit(void)</li>
</ol>
<p>功能：ESP8266 WIFI模块工作模式初始化</p>
<p>入口：无 出口：无</p>
<ol start="7" type="1">
<li>ESP8266_SendData(uchar *pbuf)</li>
</ol>
<p>功能：ESP8266 WIFI发送数据到APP</p>
<p>入口：数据 出口：无</p>
<ol start="8" type="1">
<li>wifi_control_init(void)</li>
</ol>
<p>功能：WIFI控制的初始化</p>
<p>入口：无 出口：无</p>
<h2><span id="eeprom断电不丢失模块">EEPROM断电不丢失模块</span></h2>
<p><strong>定义的端口</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sbit sda = P2 ^ <span class="number">0</span>; <span class="comment">//I2C总线数据线</span></span><br><span class="line">sbit scl = P2 ^ <span class="number">1</span>; <span class="comment">//I2C总线时钟线</span></span><br></pre></td></tr></table></figure>
<p><strong>函数设计</strong></p>
<ol type="1">
<li><p>c02_init()</p>
<p>功能：初始化24C02芯片</p>
<p>入口：无，出口：无</p></li>
<li><p>start()</p></li>
</ol>
<p>功能：启动II2C总线</p>
<p>入口：无 出口：无</p>
<ol start="3" type="1">
<li>stop()</li>
</ol>
<p>功能：停止II2C总线</p>
<p>入口：无 出口：无</p>
<ol start="4" type="1">
<li>writebyte(unsigned char j)</li>
</ol>
<p>功能：向数据线中写入一个字节</p>
<p>入口：一个字符数据 出口：无</p>
<ol start="5" type="1">
<li>readbyte()</li>
</ol>
<p>功能：读取数据线中的一个字节</p>
<p>入口：无 出口：无</p>
<ol start="6" type="1">
<li>read24c02(unsigned char address)</li>
</ol>
<p>功能：从24c02的地址address中读取一个字节数据</p>
<p>入口：24C02的地址 出口：无</p>
<ol start="7" type="1">
<li>write24c02(unsigned char address, unsigned char info)</li>
</ol>
<p>功能：向24c02的address地址中写入一字节数据info</p>
<p>入口：地址，字符数据 出口：无</p>
<ol start="8" type="1">
<li>save_data()</li>
</ol>
<p>功能：保存温度和湿度数据</p>
<p>入口：无 出口：无</p>
<ol start="9" type="1">
<li>read_data()</li>
</ol>
<p>功能：读取保存的温度和湿度数据</p>
<p>入口：无 出口：无</p>
<hr>
<h1><span id="结果及测试分析">结果及测试分析</span></h1>
<h2><span id="硬件电路">硬件电路</span></h2>
<figure>
<img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240401190005994.png" alt="image-20240401190005994">
<figcaption aria-hidden="true">image-20240401190005994</figcaption>
</figure>
<center style="color:#C0C0C0;text-decoration:underline">
硬件实物图
</center>
<p><strong>说明</strong></p>
<p>硬件部分的连接过程在原理图中都有具体列出。</p>
<p>对于电源模块，由于51单片机自带的电源输出端口只有一个5V和3.3V不能够满足我们众多外加模块的供电需求，所以我这里采用面包板模拟拓展5V电源和3.3V电源。</p>
<p>在连接实物图时由于51单片机自带的12864端口会遮挡住引脚的连接，所以在这里我采用杜邦线把51单片机端口与12864端口相连接。DHT11温湿度传感器直接连接我们配置好的引脚并连接电源即可。继电器模块由于我们采用的是电平触发模式，所以需要把继电器模块的IN端口连接至配置好的端口并接上电源即可，COM端口接地、NC端口接电源，NO端口悬空，直流电机分别于GND和NC端口相连从而达到继电器控制直流电机的效果。ESP8266WIFI模块的RX和TX分别于单片机的TX和RX相连并且连接上3.3V电源和GND就可以达到上传数据至上位机和云平台的效果。</p>
<h2><span id="测试记录及结果分析">测试记录及结果分析</span></h2>
<p><strong>测试记录</strong></p>
<ol type="1">
<li><p>首先通过usb线把单片机和电脑相连烧录程序，烧录完程序将自动进入初始界面，初始界面如下图所示。</p></li>
<li><p>当显示初始界面3s过后将会自动跳转至设置温度和湿度阈值的界面，然后通过独立键盘K1<sub>K4分别设置温度上限、温度下限、湿度上限、湿度下限，通过矩阵键盘K1</sub>K9设置温湿度阈值的具体数值</p></li>
</ol>
<figure>
<img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240402142651498.png" alt="image-20240402142651498">
<figcaption aria-hidden="true">image-20240402142651498</figcaption>
</figure>
<center style="color:#C0C0C0;text-decoration:underline">
设置温湿度阈值
</center>
<ol start="3" type="1">
<li>当设置好温湿度阈值时，点击矩阵键盘的K13即可进入温湿度显示页面，该页面可以显示温湿度的当前值和温湿度上下限值，显示界面如下图所示。</li>
</ol>
<figure>
<img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240402142717976.png" alt="image-20240402142717976">
<figcaption aria-hidden="true">image-20240402142717976</figcaption>
</figure>
<center style="color:#C0C0C0;text-decoration:underline">
温湿度显示界面
</center>
<ol start="4" type="1">
<li><p>当温度和湿度超过设定的阈值时，继电器会启动，继电器的指示灯变为绿灯。</p></li>
<li><p>当按下矩阵键盘的K14键即可把单片机获取的温湿度数据发送至onenet云平台进行存储，我还绘制了一个可视化平台用来实时展示单片机获取的数据。数据存储以及可视化展示如下图所示。</p></li>
</ol>
<figure>
<img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240402142820087.png" alt="image-20240402142820087">
<figcaption aria-hidden="true">image-20240402142820087</figcaption>
</figure>
<center style="color:#C0C0C0;text-decoration:underline">
云平台数据存储
</center>
<figure>
<img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240402142910194.png" alt="image-20240402142910194">
<figcaption aria-hidden="true">image-20240402142910194</figcaption>
</figure>
<center style="color:#C0C0C0;text-decoration:underline">
可视化数据显示
</center>
<ol start="6" type="1">
<li>我还制作了配套的微信小程序方便客户在手机端实时对温湿度的情况进行掌控和调配，小程序的页面如下图所示。</li>
</ol>
<figure>
<img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240402142943992.png" alt="image-20240402142943992">
<figcaption aria-hidden="true">image-20240402142943992</figcaption>
</figure>
<center style="color:#C0C0C0;text-decoration:underline">
微信小程序后台显示
</center>
<ol start="7" type="1">
<li>单片机与上位机通信，能够通过单片机实时把数据发送给电脑，电脑显示的数据如下图所示。</li>
</ol>
<figure>
<img src="https://blog-images-1325348240.cos.ap-nanjing.myqcloud.com/undefinedimage-20240402143022570.png" alt="image-20240402143022570">
<figcaption aria-hidden="true">image-20240402143022570</figcaption>
</figure>
<ol start="8" type="1">
<li>当断开单片机电源再接通单片机电源时我们设置的单片机上下限值会被保。</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://github.com/qqaz1234/Collect-temperature-and-humidity-display-and-cloud-data-storage">完整的项目地址</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://eejhongxin.github.io/2024/03/25/%E5%BC%80%E7%AF%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="eejhx">
      <meta itemprop="description" content="见你潜入深海，伴我匿于人间">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="嵌入小屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/03/25/%E5%BC%80%E7%AF%87/" class="post-title-link" itemprop="url">开篇</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-03-25 19:19:32" itemprop="dateCreated datePublished" datetime="2024-03-25T19:19:32+08:00">2024-03-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2026-01-17 21:26:33" itemprop="dateModified" datetime="2026-01-17T21:26:33+08:00">2026-01-17</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>96</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1><span id="welcome-to-embedded-room">Welcome to embedded room</span></h1>
<p><strong>嵌入小屋</strong>
是一个嵌入式技术分享平台，主要记录我在学习嵌入式过程中遇到的技术问题和解决方案（可能也不只是嵌入式技术）在观看过程中有任何问题欢迎用邮箱私我。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="eejhx"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">eejhx</p>
  <div class="site-description" itemprop="description">见你潜入深海，伴我匿于人间</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">8</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="mailto:eejhongxin@163.com" title="E-Mail → mailto:eejhongxin@163.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2024-03 – 
  <span itemprop="copyrightYear">2026</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">eejhx</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">15k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">14 分钟</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
